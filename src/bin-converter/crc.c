/*! *******************************************************************************************************
* Copyright (c) 2018-2019 K. Sz. Horvath
*
* All rights reserved
*
* \file crc.c
*
* \brief CRC algorithms
*
* \author K. Sz. Horvath
*
**********************************************************************************************************/

//--------------------------------------------------------------------------------------------------------/
// Include files
//--------------------------------------------------------------------------------------------------------/
#include "types.h"
#include "binconvert.h"

// Own include
#include "crc.h"


//--------------------------------------------------------------------------------------------------------/
// Definitions
//--------------------------------------------------------------------------------------------------------/


//--------------------------------------------------------------------------------------------------------/
// Types
//--------------------------------------------------------------------------------------------------------/


//--------------------------------------------------------------------------------------------------------/
// Global variables
//--------------------------------------------------------------------------------------------------------/


//--------------------------------------------------------------------------------------------------------/
// Static function declarations
//--------------------------------------------------------------------------------------------------------/


//--------------------------------------------------------------------------------------------------------/
// Static functions
//--------------------------------------------------------------------------------------------------------/
/*! *******************************************************************
 * \brief
 * \param
 * \return
 *********************************************************************/

 /*! *******************************************************************
 * \brief
 * \param
 * \return
 *********************************************************************/


//--------------------------------------------------------------------------------------------------------/
// Interface functions
//--------------------------------------------------------------------------------------------------------/
/*! *******************************************************************
 * \brief  Calculate the 16-bit CRC-CCITT of the Q-subcode
 * \param  psSubCodeQ: pointer to the Q-subcode structure
 * \return Calculated CRC
 * \note   Generator polynomial: x^16 + x^12 + x^5 + 1 == 0x11021
 *********************************************************************/
U16 CRC_QSubcode( S_CD_SUBCODE_Q* psSubCodeQ )
{
  U16 u16CRC = 0;
  U8  u8ByteIndex, u8BitIndex;
  U8  u8BitMask, u8Data, u8Flag;

  for( u8ByteIndex = 0; u8ByteIndex < sizeof( S_CD_SUBCODE_Q )-2; u8ByteIndex++ )
  {
    u8Data = ((U8*)psSubCodeQ)[ u8ByteIndex ];
    u8BitMask = 0x80u;
    for( u8BitIndex = 0; u8BitIndex < 8; u8BitIndex++ )
    {
      u8Flag = (u16CRC & 0x8000u) ? 1u : 0u;
      u16CRC = u16CRC << 1u;
      if( u8BitMask & u8Data )
      {
        u16CRC++;
      }
      if( u8Flag )
      {
        u16CRC ^= 0x1021;
      }
      u8BitMask = u8BitMask >> 1u;
    }
  }
  for( u8ByteIndex = 0; u8ByteIndex < sizeof( U16 ); u8ByteIndex++ )
  {
    u8Data = 0x00u;
    u8BitMask = 0x80u;
    for( u8BitIndex = 0; u8BitIndex < 8; u8BitIndex++ )
    {
      u8Flag = (u16CRC & 0x8000u) ? 1u : 0u;
      u16CRC = u16CRC << 1u;
      if( u8BitMask & u8Data )
      {
        u16CRC++;
      }
      if( u8Flag )
      {
        u16CRC ^= 0x1021;
      }
      u8BitMask = u8BitMask >> 1u;
    }
  }

  return ~u16CRC;
}

 /*! *******************************************************************
 * \brief
 * \param
 * \return
 *********************************************************************/



//-----------------------------------------------< EOF >--------------------------------------------------/
